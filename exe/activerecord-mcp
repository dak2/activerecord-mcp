#!/usr/bin/env ruby

require_relative "../lib/activerecord_mcp"

# Load Rails environment if available
begin
  if File.exist?("config/application.rb")
    require "./config/environment"
    puts "âœ“ Rails environment loaded"
  end
rescue => e
  puts "âš  Could not load Rails environment: #{e.message}"
  puts "âš  Some features may be limited"
end

# Configure ActiveRecordMcp if needed
ActiveRecordMcp.configure do |config|
  config.rails_root = Dir.pwd
end

# Start the MCP server
puts "ğŸš€ Starting ActiveRecord MCP server..."
puts "ğŸ“ Rails root: #{ActiveRecordMcp.configuration.rails_root}"

begin
  ActiveRecordMcp::Server.start
rescue Interrupt
  puts "\nğŸ‘‹ Shutting down gracefully..."
rescue => e
  puts "âŒ Error starting server: #{e.message}"
  puts e.backtrace.first(5).join("\n")
  exit 1
end
